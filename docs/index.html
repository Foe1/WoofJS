<!DOCTYPE html>
<html style="height:100%">
<head>
  <meta charset="utf-8">
  <title>WoofJS</title>
  <script type="text/javascript" src="https://cdn.rawgit.com/showdownjs/showdown/984942e239c9bda522b9c5544aba72647983b3f1/dist/showdown.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.js"></script>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="./codemirror/codemirror.css">
  <script type="text/javascript" src="./codemirror/codemirror.js"></script>
  <script type="text/javascript" src="./codemirror/javascript.js"></script>
  <script type="text/javascript" src="./codemirror/closebrackets.js"></script>
  <script type="text/javascript" src="./codemirror/javascript-hint.js"></script>
  <script type="text/javascript" src="./codemirror/javascript-lint.js"></script>
  <script type="text/javascript" src="./codemirror/matchbrackets.js"></script>
  <script type="text/javascript" src="./codemirror/search.js"></script>
  <script type="text/javascript" src="./codemirror/searchcursor.js"></script>
  <script type="text/javascript" src="./codemirror/show-hint.js"></script>
  <script type="text/javascript" src="./codemirror/sublime.js"></script>
  <link rel="stylesheet" href="./codemirror/dialog.css">
  <link rel="stylesheet" href="./codemirror/show-hint.css">
  <script src="./codemirror/dialog.js"></script>
  <link rel="stylesheet" href="./codemirror/lint.css">
  <script src="./codemirror/jshint.min.js"></script>
  <script src="./codemirror/lint.js"></script>

  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 25px;
    }
    .CodeMirror {
        height: 100%;
        font-size: 13px;
    }
    #title, #title a{
        font-size: 20px;
        margin-left: auto;
        margin-right: auto;
        color: white;
    }
    iframe {
        border: none;
    } 
    #navbar {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #344D97; 
      color:white; 
      height:40px; 
      width:100%; 
    }
    #powered {
        font-size: 10px;
    }
    h4 {
      text-align: center;
    }
    #container {
      width:100%;
      display:flex;
      flex-direction:row;
      
      /* Firefox */
      height: -moz-calc(99% - 40px);
      /* WebKit */
      height: -webkit-calc(99% - 40px);
      /* Opera */
      height: -o-calc(99% - 40px);
      /* Standard */
      height: calc(99% - 40px);
    }
    #instructions {
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      -o-user-select: none;
      user-select: none;
    }
    .step {
      margin-left: 5px;
      margin-right: 10px;
      margin-top: 20px;
      margin-bottom: 20px;
      padding: 5px;
      background-color: lightblue;
    }
  </style>
</head>
<body style="height:100%">
    <div id="navbar" style="">
        <span id="title"><a target="blank" href="https://github.com/stevekrouse/WoofJS">WoofJS</a> <span id="powered">powered by</span> <a target="blank" href="http://www.thecodingspace.com/"><img style="width:30px; height 30px;" src="./logo-1.png"></img></a></span>
    </div>

    <div id="container" >
        <div id="docs" style="height:100%; width: 33%; padding-left: 5px;">
            <iframe src="./docs/index.html" id="scratch" style="height:100%; width:100%"></iframe>
        </div>
        
        <div id="code" style="height:100%; width: 40%;">
        </div>
        
        <div id="output" style=" height:100%; width:36%">
            <iframe scrolling="no" id="preview" style="height:100%; width:100%"></iframe>
        </div>
    </div>
    
  <script>
	var changed = false;
    var editor = CodeMirror(document.getElementById('code'), {
        mode:  "javascript",
        value: "setBackdropURL('http://i.imgur.com/q6Bqraw.jpg')\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
        lineNumbers: true,
        theme: "eclipse",
        keyMap: "sublime",
        autoCloseBrackets: true,
        matchBrackets: true,
        autofocus: true,
        smartIndent: true,
        gutters: ["CodeMirror-lint-markers"],
        lint: {
          delay: 800, 
          options: {
            "esversion": 6,
            "esnext": true,
            "asi": true
          }
        },
    });
    editor.on("change", function(){
      changed = true;
      debouncedRunCode()
    });
    runCode();
    
    function runCode() {
      console.log('run')
        var iframe = document.getElementById('preview');
        
        iframe.src = "";
        setTimeout(function() {
            var script = iframe.contentWindow.document.createElement("script");
            script.type = "text/javascript";
            script.src = "https://cdn.rawgit.com/stevekrouse/WoofJS/dc0d2c74c173a49d8d5e7282b544392bfed8c307/woof.js";
            iframe.contentWindow.document.body.appendChild(script);
            
            script.onload = function() {
                var evt = document.createEvent('Event');  
                evt.initEvent('load', false, false);  
                iframe.contentWindow.dispatchEvent(evt);
                iframe.contentWindow.eval(editor.getValue());
            }
        }, 10)
    }
    function debounce(func, wait, immediate) {
    	var timeout;
    	return function() {
    		var context = this, args = arguments;
    		var later = function() {
    			timeout = null;
    			if (!immediate) func.apply(context, args);
    		};
    		var callNow = immediate && !timeout;
    		clearTimeout(timeout);
    		timeout = setTimeout(later, wait);
    		if (callNow) func.apply(context, args);
    	};
    };
    var debouncedRunCode = debounce(runCode, 1000, false)
    
  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  
    ga('create', 'UA-82374072-1', 'auto');
    ga('send', 'pageview');
  
  </script>

</body>
</html>